if [ ! "$(pgrep -u $UID gpg-agent)" ]; then
    echo "gpg-agent not running..."
    echo "Starting gpg-agent..."
    eval $(gpg-agent --daemon --enable-ssh-support --write-env-file)
    echo "WARNING: If you only use gpg-agent for rpass, don't worry about this. If not (i.e. you also encrypt/sign files), start gpg-agent as per its manpage on login (i.e. in .xsession or in .profile)."
fi

rpass_command="rpass_py_interface"

[ ! -t 1 ] && rpass_command=$rpass_command" --no-color"

count=0
if [ ! -t 0 ]; then
    while read line; do
        count=1
        $rpass_command "$@" "$line"
    done
fi

[ $count -eq 0 ] && $rpass_command "$@"

# vim: filetype=sh :
